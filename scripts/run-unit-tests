#!/bin/bash

scripts_path=./$(dirname $0)
eval $($scripts_path/get_paths.sh)

set -e
${scripts_path}/check-metrics-documentation
set +e

ERROR_CODE=0

if [ ! -z ${RUN_SQL_TESTS} ]; then
  USE_SQL=mysql $scripts_path/run-unit-tests-with-backing-store
  ERROR_CODE=$?

  USE_SQL=postgres $scripts_path/run-unit-tests-with-backing-store
  let ERROR_CODE+=$?
fi

$scripts_path/run-unit-tests-with-backing-store
let ERROR_CODE+=$?

$scripts_path/run-unit-tests-no-backing-store
let ERROR_CODE+=$?

if [ ${ERROR_CODE} -eq 0 ]; then
  echo "Diego Unit Tests Passed."
else
  echo "Diego Unit Tests Failed!"
fi

exit ${ERROR_CODE}
